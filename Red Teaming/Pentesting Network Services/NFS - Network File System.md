### Understanding
NFS, or Network File System, is a distributed file protocol that enables remote access to files over a network. It operates on port <mark style="background: #FF5582A6;">2049</mark> by default. When we talk about mounting a share in NFS, it means <mark style="background: #FF5582A6;">connecting a remote file system to a local directory</mark>, making it accessible as if it were a part of the local file system.

<mark style="background: #FF5582A6;">Pros of NFS</mark>:
1. Easy File Sharing: NFS allows seamless sharing of files across multiple machines in a network, making collaboration and data access more convenient.
2. Centralized Management: With NFS, administrators can manage and control file access from a central location, simplifying file management tasks.
3. Efficient Resource Utilization: NFS enables efficient utilization of storage resources as files can be stored on a centralized server and accessed by multiple clients.

<mark style="background: #BBFABBA6;">Cons of NFS</mark>:
1. Security Risks: If not properly configured, NFS can be vulnerable to security breaches and unauthorized access. It's important to implement appropriate security measures to protect sensitive data.
2. Performance Limitations: NFS performance may degrade over long distances or high-latency networks due to the overhead of network communication, impacting file access speed.
3. Dependency on Network Availability: Since NFS relies on network connectivity, any network interruptions or failures can disrupt file access and availability.

![[linux-nfs-diagram.png]]

**Versions**

(From [https://academy.hackthebox.com/module/112/section/1068](https://academy.hackthebox.com/module/112/section/1068))

|   |   |
|---|---|
|**Version**|**Features**|
|`NFSv2`|It is **older** but is supported by many systems and was initially operated entirely over UDP.|
|`NFSv3`|It has more features, including variable file size and better error reporting, but is not fully compatible with NFSv2 clients.|
|`NFSv4`|It includes Kerberos, works through firewalls and on the Internet, **no longer requires portmappers**, supports ACLs, applies state-based operations, and provides performance improvements and high **security**. It is also the first version to have a stateful protocol.|

### Enumerating & Exploiting

**Useful nmap scripts**

```bash
nfs-ls List NFS exports and check permissions
nfs-showmount Like showmount -e
nfs-statfs Disk statistics and info from NFS share
--script=nfs-ls.nse,nfs-showmount.nse,nfs-statfs.nse -p 2049 {IP}
```

**Useful metasploit modules**

```bash
scanner/nfs/nfsmount Scan NFS mounts and list permissions
```

**Mounting**

To know **which folder** has the server **available** to mount you an ask it using:

```bash
showmount -e <IP>
```

Then mount it using:

```bash
sudo mount -t nfs [-o vers=2] <ip>:<remote_folder> <local_folder> -o nolock
```
|   |   |
|---|---|
|**Tag**|**Function**|
|sudo|Run as root|
|mount|Execute the mount command|
|-t nfs|Type of device to mount, then specifying that it's NFS|
|ip:remote_folder|The IP Address of the NFS server, and the name of the share we wish to mount|
|-nolock|Specifies not to use NLM locking|
We should specify to **use version 2** because it doesn't have **any** **authentication** or **authorization**.

**Example:**

```bash
mkdir /mnt/new_back
mount -t nfs [-o vers=2] 10.12.0.150:/backup /mnt/new_back -o nolock
```

**Permissions**

If we mount a folder which contains **files or folders only accesible by some user** (by **UID**). We can **create** **locally** a user with that **UID** and using that **user** we will be able to **access** the file/folder.

**NSFShell**

To easily list, mount and change UID and GID to have access to files we can use [nfsshell](https://github.com/NetDirect/nfsshell).

[Nice NFSShell tutorial.](https://www.pentestpartners.com/security-blog/using-nfsshell-to-compromise-older-environments/)

**Config files**

```bash
/etc/exports
/etc/lib/nfs/etab
```

**Dangerous settings**

(From [https://academy.hackthebox.com/module/112/section/1068](https://academy.hackthebox.com/module/112/section/1068))

|   |   |
|---|---|
|**Option**|**Description**|
|`rw`|Read and write permissions.|
|`insecure`|Ports above 1024 will be used.|
|`nohide`|If another file system was mounted below an exported directory, this directory is exported by its own exports entry.|
|`no_root_squash`|All files created by root are kept with the UID/GID 0.|
|`no_all_squash`||